<body>
  <header>SRW+ System</header>
  <div class='sheet-row'>
    <label class='sheet-character-personal-info'>Pilot Name: <input type='text' name='attr_pilot_name'></label>
    <label class='sheet-character-personal-info'>Mecha Name: <input type='text' name='attr_mecha_name'></label>
    <label class='sheet-character-personal-info'>Level: <input type='number' name='attr_Level'></label>
  </div>
  <div class='sheet-row'>
    <h3>Resources</h3>
    <div class='sheet-statistic-row'>
      <div class='sheet-resource-cell'>
        <label class='sheet-resource-label'>Curr. HP</label>
        <label class='sheet-resource-label'>/</label>
        <label class='sheet-resource-label'>Max HP</label>
      </div>
      <div class='sheet-resource-cell'>
        <input value='0' type='number' title='@{HP}' name='attr_HP'></input>
        <span>/</span>
        <input readonly type='number' title='@{HP|max}' name='attr_HP_max'></input>
      </div>
    </div>
    <div class='sheet-statistic-row'>
      <div class='sheet-resource-cell'>
        <label class='sheet-resource-label'>Curr. Will</label>
        <label class='sheet-resource-label'>/</label>
        <label class='sheet-resource-label'>Max Will</label>
      </div>
      <div class='sheet-resource-cell'>
        <input value='0' type='number' title='@{Will}' name='attr_Will'></input>
        <span>/</span>
        <input readonly type='number' title='@{Will|max}' name='attr_Will_max'></input>
      </div>
    </div>
    <div class='sheet-statistic-row'>
      <div class='sheet-resource-cell'>
        <label class='sheet-resource-label'>Curr. EN</label>
        <label class='sheet-resource-label'>/</label>
        <label class='sheet-resource-label'>Max EN</label>
      </div>
      <div class='sheet-resource-cell'>
        <input value='0' type='number' title='@{Energy}' name='attr_Energy'></input>
        <span>/</span>
        <input readonly type='number' title='@{Energy|max}' name='attr_Energy_max'></input>
      </div>
    </div>
    <div class='sheet-statistic-row'>
      <div class='sheet-resource-cell'>
        <label class='sheet-resource-label'>Curr. SP</label>
        <label class='sheet-resource-label'>/</label>
        <label class='sheet-resource-label'>Max SP</label>
      </div>
      <div class='sheet-resource-cell'>
        <input value='0' type='number' title='@{Spirit}' name='attr_Spirit'></input>
        <span>/</span>
        <input readonly type='number' title='@{Spirit|max}' name='attr_Spirit_max'></input>
      </div>
    </div>
  </div>
  <div class=sheet-row>
    <h3>Attributes</h3>
    <div class='sheet-statistic-row'>
      <label class='sheet-attribute-label'>Base HP</label>
      <input value='0' type='number' title='@{HP_base}' name='attr_HP_base'></input>
    </div>
    <div class='sheet-statistic-row'>
      <label class='sheet-attribute-label'>Base Will</label>
      <input value='0' type='number' title='@{Will_base}' name='attr_Will_base'></input>
    </div>
    <div class='sheet-statistic-row'>
      <label class='sheet-attribute-label'>Base Energy</label>
      <input value='0' type='number' title='@{Energy_base}' name='attr_Energy_base'></input>
    </div>
    <div class='sheet-statistic-row'>
      <label class='sheet-attribute-label'>Base Spirit</label>
      <input value='0' type='number' title='@{Spirit_base}' name='attr_Spirit_base'></input>
    </div>
    <div class='sheet-statistic-row'>
      <label class='sheet-attribute-label'>Armor</label>
      <input value='0' type='number' title='@{Armor_base}' name='attr_Armor_base'></input>
    </div>
    <div class='sheet-statistic-row'>
      <label class='sheet-attribute-label'>Accuracy</label>
      <input value='0' type='number' title='@{Accuracy_base}' name='attr_Accuracy_base'></input>
    </div>
    <div class='sheet-statistic-row'>
      <label class='sheet-attribute-label'>Evade</label>
      <input value='0' type='number' title='@{Evade_base}' name='attr_Evade_base'></input>
    </div>
    <div class='sheet-statistic-row'>
      <label class='sheet-attribute-label'>Skill</label>
      <input value='0' type='number' title='@{Skill_base}' name='attr_Skill_base'></input>
    </div>
  </div>
  <span class='sheet-version-number'><input type='string' name='sheet-version-number'></span>
</body>
<script type='text/worker'>

<!-- Use common functions to calculate derived stats. It's not strictly
  -- necessary, but it means we don't have to update a macro inline, buried in
  -- html, every time the derived stat formula changes. This should only be used
  -- for rarely updated stats, like maximum values of resource pools.
  -->
var calculateMaxWill = function() {
  getAttrs(['Will_base'], function(values) {
    setAttrs({ Will_max: values.Will_base || 0 });
  });
};

var calculateMaxSpirit = function() {
  getAttrs(['Spirit_base'], function(values) {
    setAttrs({ Spirit_max: values.Spirit_base || 0 });
  });
};

var calculateMaxHP = function() {
  getAttrs(['HP_base'], function(values) {
    setAttrs({ HP_max: values.HP_base || 0 });
  });
};

var calculateMaxEnergy = function() {
  getAttrs(['Energy_base'], function(values) {
    setAttrs({ Energy_max: values.Energy_base || 0 });
  });
};

on('sheet:opened', function() {
  <!-- Initialize all stats if needed on sheet open. -->
  getAttrs([ 'Will_max', 'Spirit_max', 'HP_max', 'Energy_max'], function(values) {
    if(values.Will_max === '') calculateMaxWill();
    if(values.Spirit_max === '') calculateMaxSpirit();
    if(values.HP_max === '') calculateMaxHP();
    if(values.Energy_max === '') calculateMaxEnergy();
  });
});

on('change:will_base', function() {
  calculateMaxWill();
});

on('change:spirit_base', function() {
  calculateMaxSpirit();
});

on('change:hp_base', function() {
  calculateMaxHP();
});

on('change:energy_base', function() {
  calculateMaxEnergy();
});

</script>
